{"mappings":"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","sources":["<anon>","src/components/graph-interaction.js"],"sourcesContent":["/**\r\n * Graph Interaction Component for A-Frame\r\n * Handles hover and click interactions for graph nodes\r\n * Shows info panel and highlights connections\r\n */ /* global AFRAME */ // Race display names (same as 2D)\nconst RACE_NAMES = {\n    'men': 'Men',\n    'elves': 'Elves',\n    'hobbit': 'Hobbit',\n    'dwarf': 'Dwarf',\n    'ainur': 'Ainur',\n    'ents': 'Ent',\n    'orcs': 'Orc',\n    'animal': 'Animal'\n};\nAFRAME.registerComponent('graph-interaction', {\n    schema: {\n        infoPanelId: {\n            type: 'string',\n            default: 'info-panel'\n        },\n        graphContainerId: {\n            type: 'string',\n            default: 'graph-container'\n        }\n    },\n    init: function() {\n        this.selectedNodeId = null;\n        this.hoveredNodeId = null;\n        this.graphLoader = null;\n        this.infoPanel = null;\n        this.isHoverLocked = false; // Prevents rapid hover changes\n        // Bind event handlers\n        this.onNodeMouseEnter = this.onNodeMouseEnter.bind(this);\n        this.onNodeMouseLeave = this.onNodeMouseLeave.bind(this);\n        this.onNodeClick = this.onNodeClick.bind(this);\n        this.onBackgroundClick = this.onBackgroundClick.bind(this);\n        this.onGraphLoaded = this.onGraphLoaded.bind(this);\n        // Wait for graph to load\n        this.el.addEventListener('graph-loaded', this.onGraphLoaded);\n    },\n    onGraphLoaded: function(evt) {\n        console.log('[GraphInteraction] Graph loaded, setting up interactions');\n        // Get reference to graph-loader component\n        const graphContainer = document.getElementById(this.data.graphContainerId);\n        if (graphContainer) this.graphLoader = graphContainer.components['graph-loader'];\n        // Get info panel\n        this.infoPanel = document.getElementById(this.data.infoPanelId);\n        // Setup event listeners for all nodes\n        this.setupNodeListeners();\n        // Bind background hover handler\n        this.onBackgroundHover = this.onBackgroundHover.bind(this);\n        // Setup background click and hover to reset\n        const background = document.querySelector('#background');\n        if (background) {\n            background.addEventListener('click', this.onBackgroundClick);\n            background.addEventListener('mouseenter', this.onBackgroundHover);\n        }\n        // Also listen to sky click and hover\n        const sky = document.querySelector('a-sky');\n        if (sky) {\n            sky.addEventListener('click', this.onBackgroundClick);\n            sky.addEventListener('mouseenter', this.onBackgroundHover);\n        }\n    },\n    onBackgroundHover: function(evt) {\n        // When cursor moves to background, clear hover visual effects\n        if (this.hoveredNodeId && this.hoveredNodeId !== this.selectedNodeId) this.resetNodeAppearance(this.hoveredNodeId);\n        this.hoveredNodeId = null;\n        // If a node is selected, keep showing its info panel\n        // Otherwise hide the info panel\n        if (this.selectedNodeId) this.showInfoPanel(this.selectedNodeId);\n        else this.hideInfoPanel();\n    },\n    setupNodeListeners: function() {\n        const nodes = document.querySelectorAll('.graph-node');\n        nodes.forEach((nodeEl)=>{\n            nodeEl.addEventListener('mouseenter', this.onNodeMouseEnter);\n            nodeEl.addEventListener('mouseleave', this.onNodeMouseLeave);\n            nodeEl.addEventListener('click', this.onNodeClick);\n        });\n        console.log('[GraphInteraction] Set up listeners for', nodes.length, 'nodes');\n    },\n    onNodeMouseEnter: function(evt) {\n        const nodeEl = evt.target;\n        const nodeId = nodeEl.getAttribute('data-node-id');\n        if (!nodeId) return;\n        // Already hovering this node - ignore\n        if (this.hoveredNodeId === nodeId) return;\n        // If hovering a different node, reset the previous one (but not if it's selected)\n        if (this.hoveredNodeId && this.hoveredNodeId !== this.selectedNodeId) this.resetNodeAppearance(this.hoveredNodeId);\n        // Set new hover\n        this.hoveredNodeId = nodeId;\n        // Only apply hover visual effects if this node is NOT selected\n        if (nodeId !== this.selectedNodeId) {\n            // Scale up\n            nodeEl.setAttribute('scale', '1.2 1.2 1.2');\n            // Add glow effect\n            const nodeColor = nodeEl.getAttribute('data-node-color');\n            nodeEl.setAttribute('material', 'emissive', nodeColor || '#ffffff');\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0.3);\n        }\n        // Always show info panel for hovered node\n        this.showInfoPanel(nodeId);\n    },\n    onNodeMouseLeave: function(evt) {\n        const nodeEl = evt.target;\n        const nodeId = nodeEl.getAttribute('data-node-id');\n        if (!nodeId) return;\n        // Reset hover appearance (but not if it's the selected node)\n        if (nodeId !== this.selectedNodeId) this.resetNodeAppearance(nodeId);\n        // Clear hover tracking\n        if (this.hoveredNodeId === nodeId) this.hoveredNodeId = null;\n        // Hide info panel only if no node is selected\n        // If a node is selected, show its info instead\n        if (this.selectedNodeId) this.showInfoPanel(this.selectedNodeId);\n        else this.hideInfoPanel();\n    },\n    resetNodeAppearance: function(nodeId) {\n        const nodeEl = this.graphLoader ? this.graphLoader.getNodeEntity(nodeId) : null;\n        if (!nodeEl) return;\n        // Reset scale\n        nodeEl.setAttribute('scale', '1 1 1');\n        // If a node is selected, we need to restore to the highlight state\n        // (dimmed if not connected, normal if connected)\n        if (this.selectedNodeId) {\n            // Check if this node is connected to the selected node\n            const isConnected = this.isNodeConnected(nodeId, this.selectedNodeId);\n            if (isConnected) {\n                // Connected node - keep original color\n                const nodeData = window.graphData.nodeMap[nodeId];\n                nodeEl.setAttribute('material', 'color', nodeData?.color || '#7A84DD');\n                nodeEl.setAttribute('material', 'opacity', 1);\n                nodeEl.setAttribute('material', 'emissive', '#000000');\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0);\n            } else {\n                // Unconnected node - dimmed\n                nodeEl.setAttribute('material', 'color', '#444444');\n                nodeEl.setAttribute('material', 'opacity', 0.3);\n                nodeEl.setAttribute('material', 'emissive', '#000000');\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0);\n            }\n        } else {\n            // No selection - restore to original color\n            const nodeData = window.graphData.nodeMap[nodeId];\n            nodeEl.setAttribute('material', 'color', nodeData?.color || '#7A84DD');\n            nodeEl.setAttribute('material', 'opacity', 1);\n            nodeEl.setAttribute('material', 'emissive', '#000000');\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0);\n        }\n    },\n    isNodeConnected: function(nodeId, selectedNodeId) {\n        if (nodeId === selectedNodeId) return true;\n        return window.graphData.links.some((link)=>link.source === selectedNodeId && link.target === nodeId || link.target === selectedNodeId && link.source === nodeId);\n    },\n    clearHover: function() {\n        if (this.hoveredNodeId) {\n            this.resetNodeAppearance(this.hoveredNodeId);\n            this.hoveredNodeId = null;\n            this.hideInfoPanel();\n        }\n    },\n    onNodeClick: function(evt) {\n        evt.stopPropagation();\n        const nodeEl = evt.target;\n        const nodeId = nodeEl.getAttribute('data-node-id');\n        if (!nodeId) return;\n        // Toggle selection\n        if (this.selectedNodeId === nodeId) // Clicking same node - deselect\n        this.deselectNode();\n        else // Select new node\n        this.selectNode(nodeId);\n    },\n    onBackgroundClick: function(evt) {\n        // Clear any hover state\n        this.clearHover();\n        // Deselect if something is selected\n        if (this.selectedNodeId) this.deselectNode();\n    },\n    selectNode: function(nodeId) {\n        // If there was a previously selected node, deselect it first\n        if (this.selectedNodeId && this.selectedNodeId !== nodeId) // Reset previous selection\n        {\n            if (this.graphLoader) this.graphLoader.resetHighlight();\n        }\n        // Clear any hover state on the node we're about to select\n        if (this.hoveredNodeId === nodeId) {\n            const nodeEl = this.graphLoader ? this.graphLoader.getNodeEntity(nodeId) : null;\n            if (nodeEl) nodeEl.setAttribute('scale', '1 1 1');\n        }\n        this.selectedNodeId = nodeId;\n        this.hoveredNodeId = null; // Clear hover since we're now selecting\n        // Highlight node and connections (turns node blue)\n        if (this.graphLoader) this.graphLoader.highlightNode(nodeId);\n        // Show info panel\n        this.showInfoPanel(nodeId);\n        // Emit event\n        this.el.emit('node-selected', {\n            nodeId: nodeId\n        });\n    },\n    deselectNode: function() {\n        const prevNodeId = this.selectedNodeId;\n        this.selectedNodeId = null;\n        // Reset highlights\n        if (this.graphLoader) this.graphLoader.resetHighlight();\n        // Hide info panel\n        this.hideInfoPanel();\n        // Emit event\n        this.el.emit('node-deselected', {\n            nodeId: prevNodeId\n        });\n    },\n    showInfoPanel: function(nodeId) {\n        if (!this.infoPanel || !window.graphData.nodeMap) return;\n        const node = window.graphData.nodeMap[nodeId];\n        if (!node) return;\n        // Get connections\n        const connections = this.getNodeConnections(nodeId);\n        // Update panel content\n        const nameEl = this.infoPanel.querySelector('#panel-name');\n        const raceEl = this.infoPanel.querySelector('#panel-race');\n        const genderEl = this.infoPanel.querySelector('#panel-gender');\n        const weightEl = this.infoPanel.querySelector('#panel-weight');\n        const connectionsCountEl = this.infoPanel.querySelector('#panel-connections');\n        const topConnectionsEl = this.infoPanel.querySelector('#panel-top-connections');\n        // Set values (matching 2D visualization)\n        if (nameEl) nameEl.setAttribute('value', node.label);\n        if (raceEl) raceEl.setAttribute('value', RACE_NAMES[node.race] || node.race);\n        if (genderEl) {\n            const gender = node.gender ? node.gender.charAt(0).toUpperCase() + node.gender.slice(1) : '-';\n            genderEl.setAttribute('value', gender);\n        }\n        if (weightEl) weightEl.setAttribute('value', node.weight.toString());\n        if (connectionsCountEl) {\n            const connCount = node.total_connections || connections.length;\n            connectionsCountEl.setAttribute('value', connCount.toString());\n        }\n        // Top 5 connections (matching 2D)\n        if (topConnectionsEl) {\n            const topConns = connections.slice(0, 5).map((c)=>`${c.label} (${c.weight})`).join('\\n');\n            topConnectionsEl.setAttribute('value', topConns || 'None');\n        }\n        // Show panel (it's now a HUD element attached to camera)\n        this.infoPanel.setAttribute('visible', true);\n    },\n    hideInfoPanel: function() {\n        if (this.infoPanel) this.infoPanel.setAttribute('visible', false);\n    },\n    getNodeConnections: function(nodeId) {\n        if (!window.graphData.links) return [];\n        const connections = [];\n        window.graphData.links.forEach((link)=>{\n            if (link.source === nodeId) {\n                const targetNode = window.graphData.nodeMap[link.target];\n                if (targetNode) connections.push({\n                    id: link.target,\n                    label: targetNode.label,\n                    weight: link.weight\n                });\n            } else if (link.target === nodeId) {\n                const sourceNode = window.graphData.nodeMap[link.source];\n                if (sourceNode) connections.push({\n                    id: link.source,\n                    label: sourceNode.label,\n                    weight: link.weight\n                });\n            }\n        });\n        // Sort by weight descending\n        return connections.sort((a, b)=>b.weight - a.weight);\n    },\n    capitalizeFirst: function(str) {\n        if (!str) return '-';\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n    remove: function() {\n        // Cleanup event listeners\n        const nodes = document.querySelectorAll('.graph-node');\n        nodes.forEach((nodeEl)=>{\n            nodeEl.removeEventListener('mouseenter', this.onNodeMouseEnter);\n            nodeEl.removeEventListener('mouseleave', this.onNodeMouseLeave);\n            nodeEl.removeEventListener('click', this.onNodeClick);\n        });\n        const background = document.querySelector('#background');\n        if (background) background.removeEventListener('click', this.onBackgroundClick);\n    }\n});\nconsole.log('[GraphInteraction] Component registered');\n\n//# sourceMappingURL=A-Frame-Knowledge-Graph-Visualization-fresh.dc5094d7.js.map\n","/**\r\n * Graph Interaction Component for A-Frame\r\n * Handles hover and click interactions for graph nodes\r\n * Shows info panel and highlights connections\r\n */\r\n\r\n/* global AFRAME */\r\n\r\n// Race display names (same as 2D)\r\nconst RACE_NAMES = {\r\n    'men': 'Men',\r\n    'elves': 'Elves',\r\n    'hobbit': 'Hobbit',\r\n    'dwarf': 'Dwarf',\r\n    'ainur': 'Ainur',\r\n    'ents': 'Ent',\r\n    'orcs': 'Orc',\r\n    'animal': 'Animal'\r\n};\r\n\r\nAFRAME.registerComponent('graph-interaction', {\r\n    schema: {\r\n        infoPanelId: { type: 'string', default: 'info-panel' },\r\n        graphContainerId: { type: 'string', default: 'graph-container' }\r\n    },\r\n\r\n    init: function () {\r\n        this.selectedNodeId = null;\r\n        this.hoveredNodeId = null;\r\n        this.graphLoader = null;\r\n        this.infoPanel = null;\r\n        this.isHoverLocked = false;  // Prevents rapid hover changes\r\n\r\n        // Bind event handlers\r\n        this.onNodeMouseEnter = this.onNodeMouseEnter.bind(this);\r\n        this.onNodeMouseLeave = this.onNodeMouseLeave.bind(this);\r\n        this.onNodeClick = this.onNodeClick.bind(this);\r\n        this.onBackgroundClick = this.onBackgroundClick.bind(this);\r\n        this.onGraphLoaded = this.onGraphLoaded.bind(this);\r\n\r\n        // Wait for graph to load\r\n        this.el.addEventListener('graph-loaded', this.onGraphLoaded);\r\n    },\r\n\r\n    onGraphLoaded: function (evt) {\r\n        console.log('[GraphInteraction] Graph loaded, setting up interactions');\r\n\r\n        // Get reference to graph-loader component\r\n        const graphContainer = document.getElementById(this.data.graphContainerId);\r\n        if (graphContainer) {\r\n            this.graphLoader = graphContainer.components['graph-loader'];\r\n        }\r\n\r\n        // Get info panel\r\n        this.infoPanel = document.getElementById(this.data.infoPanelId);\r\n\r\n        // Setup event listeners for all nodes\r\n        this.setupNodeListeners();\r\n\r\n        // Bind background hover handler\r\n        this.onBackgroundHover = this.onBackgroundHover.bind(this);\r\n\r\n        // Setup background click and hover to reset\r\n        const background = document.querySelector('#background');\r\n        if (background) {\r\n            background.addEventListener('click', this.onBackgroundClick);\r\n            background.addEventListener('mouseenter', this.onBackgroundHover);\r\n        }\r\n\r\n        // Also listen to sky click and hover\r\n        const sky = document.querySelector('a-sky');\r\n        if (sky) {\r\n            sky.addEventListener('click', this.onBackgroundClick);\r\n            sky.addEventListener('mouseenter', this.onBackgroundHover);\r\n        }\r\n    },\r\n\r\n    onBackgroundHover: function (evt) {\r\n        // When cursor moves to background, clear hover visual effects\r\n        if (this.hoveredNodeId && this.hoveredNodeId !== this.selectedNodeId) {\r\n            this.resetNodeAppearance(this.hoveredNodeId);\r\n        }\r\n        this.hoveredNodeId = null;\r\n\r\n        // If a node is selected, keep showing its info panel\r\n        // Otherwise hide the info panel\r\n        if (this.selectedNodeId) {\r\n            this.showInfoPanel(this.selectedNodeId);\r\n        } else {\r\n            this.hideInfoPanel();\r\n        }\r\n    },\r\n\r\n    setupNodeListeners: function () {\r\n        const nodes = document.querySelectorAll('.graph-node');\r\n\r\n        nodes.forEach(nodeEl => {\r\n            nodeEl.addEventListener('mouseenter', this.onNodeMouseEnter);\r\n            nodeEl.addEventListener('mouseleave', this.onNodeMouseLeave);\r\n            nodeEl.addEventListener('click', this.onNodeClick);\r\n        });\r\n\r\n        console.log('[GraphInteraction] Set up listeners for', nodes.length, 'nodes');\r\n    },\r\n\r\n    onNodeMouseEnter: function (evt) {\r\n        const nodeEl = evt.target;\r\n        const nodeId = nodeEl.getAttribute('data-node-id');\r\n\r\n        if (!nodeId) return;\r\n\r\n        // Already hovering this node - ignore\r\n        if (this.hoveredNodeId === nodeId) return;\r\n\r\n        // If hovering a different node, reset the previous one (but not if it's selected)\r\n        if (this.hoveredNodeId && this.hoveredNodeId !== this.selectedNodeId) {\r\n            this.resetNodeAppearance(this.hoveredNodeId);\r\n        }\r\n\r\n        // Set new hover\r\n        this.hoveredNodeId = nodeId;\r\n\r\n        // Only apply hover visual effects if this node is NOT selected\r\n        if (nodeId !== this.selectedNodeId) {\r\n            // Scale up\r\n            nodeEl.setAttribute('scale', '1.2 1.2 1.2');\r\n\r\n            // Add glow effect\r\n            const nodeColor = nodeEl.getAttribute('data-node-color');\r\n            nodeEl.setAttribute('material', 'emissive', nodeColor || '#ffffff');\r\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0.3);\r\n        }\r\n\r\n        // Always show info panel for hovered node\r\n        this.showInfoPanel(nodeId);\r\n    },\r\n\r\n    onNodeMouseLeave: function (evt) {\r\n        const nodeEl = evt.target;\r\n        const nodeId = nodeEl.getAttribute('data-node-id');\r\n\r\n        if (!nodeId) return;\r\n\r\n        // Reset hover appearance (but not if it's the selected node)\r\n        if (nodeId !== this.selectedNodeId) {\r\n            this.resetNodeAppearance(nodeId);\r\n        }\r\n\r\n        // Clear hover tracking\r\n        if (this.hoveredNodeId === nodeId) {\r\n            this.hoveredNodeId = null;\r\n        }\r\n\r\n        // Hide info panel only if no node is selected\r\n        // If a node is selected, show its info instead\r\n        if (this.selectedNodeId) {\r\n            this.showInfoPanel(this.selectedNodeId);\r\n        } else {\r\n            this.hideInfoPanel();\r\n        }\r\n    },\r\n\r\n    resetNodeAppearance: function (nodeId) {\r\n        const nodeEl = this.graphLoader ? this.graphLoader.getNodeEntity(nodeId) : null;\r\n        if (!nodeEl) return;\r\n\r\n        // Reset scale\r\n        nodeEl.setAttribute('scale', '1 1 1');\r\n\r\n        // If a node is selected, we need to restore to the highlight state\r\n        // (dimmed if not connected, normal if connected)\r\n        if (this.selectedNodeId) {\r\n            // Check if this node is connected to the selected node\r\n            const isConnected = this.isNodeConnected(nodeId, this.selectedNodeId);\r\n\r\n            if (isConnected) {\r\n                // Connected node - keep original color\r\n                const nodeData = window.graphData.nodeMap[nodeId];\r\n                nodeEl.setAttribute('material', 'color', nodeData?.color || '#7A84DD');\r\n                nodeEl.setAttribute('material', 'opacity', 1);\r\n                nodeEl.setAttribute('material', 'emissive', '#000000');\r\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0);\r\n            } else {\r\n                // Unconnected node - dimmed\r\n                nodeEl.setAttribute('material', 'color', '#444444');\r\n                nodeEl.setAttribute('material', 'opacity', 0.3);\r\n                nodeEl.setAttribute('material', 'emissive', '#000000');\r\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0);\r\n            }\r\n        } else {\r\n            // No selection - restore to original color\r\n            const nodeData = window.graphData.nodeMap[nodeId];\r\n            nodeEl.setAttribute('material', 'color', nodeData?.color || '#7A84DD');\r\n            nodeEl.setAttribute('material', 'opacity', 1);\r\n            nodeEl.setAttribute('material', 'emissive', '#000000');\r\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0);\r\n        }\r\n    },\r\n\r\n    isNodeConnected: function (nodeId, selectedNodeId) {\r\n        if (nodeId === selectedNodeId) return true;\r\n\r\n        return window.graphData.links.some(link =>\r\n            (link.source === selectedNodeId && link.target === nodeId) ||\r\n            (link.target === selectedNodeId && link.source === nodeId)\r\n        );\r\n    },\r\n\r\n    clearHover: function () {\r\n        if (this.hoveredNodeId) {\r\n            this.resetNodeAppearance(this.hoveredNodeId);\r\n            this.hoveredNodeId = null;\r\n            this.hideInfoPanel();\r\n        }\r\n    },\r\n\r\n    onNodeClick: function (evt) {\r\n        evt.stopPropagation();\r\n\r\n        const nodeEl = evt.target;\r\n        const nodeId = nodeEl.getAttribute('data-node-id');\r\n\r\n        if (!nodeId) return;\r\n\r\n        // Toggle selection\r\n        if (this.selectedNodeId === nodeId) {\r\n            // Clicking same node - deselect\r\n            this.deselectNode();\r\n        } else {\r\n            // Select new node\r\n            this.selectNode(nodeId);\r\n        }\r\n    },\r\n\r\n    onBackgroundClick: function (evt) {\r\n        // Clear any hover state\r\n        this.clearHover();\r\n\r\n        // Deselect if something is selected\r\n        if (this.selectedNodeId) {\r\n            this.deselectNode();\r\n        }\r\n    },\r\n\r\n    selectNode: function (nodeId) {\r\n        // If there was a previously selected node, deselect it first\r\n        if (this.selectedNodeId && this.selectedNodeId !== nodeId) {\r\n            // Reset previous selection\r\n            if (this.graphLoader) {\r\n                this.graphLoader.resetHighlight();\r\n            }\r\n        }\r\n\r\n        // Clear any hover state on the node we're about to select\r\n        if (this.hoveredNodeId === nodeId) {\r\n            const nodeEl = this.graphLoader ? this.graphLoader.getNodeEntity(nodeId) : null;\r\n            if (nodeEl) {\r\n                nodeEl.setAttribute('scale', '1 1 1');\r\n            }\r\n        }\r\n\r\n        this.selectedNodeId = nodeId;\r\n        this.hoveredNodeId = null;  // Clear hover since we're now selecting\r\n\r\n        // Highlight node and connections (turns node blue)\r\n        if (this.graphLoader) {\r\n            this.graphLoader.highlightNode(nodeId);\r\n        }\r\n\r\n        // Show info panel\r\n        this.showInfoPanel(nodeId);\r\n\r\n        // Emit event\r\n        this.el.emit('node-selected', { nodeId: nodeId });\r\n    },\r\n\r\n    deselectNode: function () {\r\n        const prevNodeId = this.selectedNodeId;\r\n        this.selectedNodeId = null;\r\n\r\n        // Reset highlights\r\n        if (this.graphLoader) {\r\n            this.graphLoader.resetHighlight();\r\n        }\r\n\r\n        // Hide info panel\r\n        this.hideInfoPanel();\r\n\r\n        // Emit event\r\n        this.el.emit('node-deselected', { nodeId: prevNodeId });\r\n    },\r\n\r\n    showInfoPanel: function (nodeId) {\r\n        if (!this.infoPanel || !window.graphData.nodeMap) return;\r\n\r\n        const node = window.graphData.nodeMap[nodeId];\r\n        if (!node) return;\r\n\r\n        // Get connections\r\n        const connections = this.getNodeConnections(nodeId);\r\n\r\n        // Update panel content\r\n        const nameEl = this.infoPanel.querySelector('#panel-name');\r\n        const raceEl = this.infoPanel.querySelector('#panel-race');\r\n        const genderEl = this.infoPanel.querySelector('#panel-gender');\r\n        const weightEl = this.infoPanel.querySelector('#panel-weight');\r\n        const connectionsCountEl = this.infoPanel.querySelector('#panel-connections');\r\n        const topConnectionsEl = this.infoPanel.querySelector('#panel-top-connections');\r\n\r\n        // Set values (matching 2D visualization)\r\n        if (nameEl) nameEl.setAttribute('value', node.label);\r\n        if (raceEl) raceEl.setAttribute('value', RACE_NAMES[node.race] || node.race);\r\n        if (genderEl) {\r\n            const gender = node.gender ? node.gender.charAt(0).toUpperCase() + node.gender.slice(1) : '-';\r\n            genderEl.setAttribute('value', gender);\r\n        }\r\n        if (weightEl) weightEl.setAttribute('value', node.weight.toString());\r\n        if (connectionsCountEl) {\r\n            const connCount = node.total_connections || connections.length;\r\n            connectionsCountEl.setAttribute('value', connCount.toString());\r\n        }\r\n\r\n        // Top 5 connections (matching 2D)\r\n        if (topConnectionsEl) {\r\n            const topConns = connections.slice(0, 5)\r\n                .map(c => `${c.label} (${c.weight})`)\r\n                .join('\\n');\r\n            topConnectionsEl.setAttribute('value', topConns || 'None');\r\n        }\r\n\r\n        // Show panel (it's now a HUD element attached to camera)\r\n        this.infoPanel.setAttribute('visible', true);\r\n    },\r\n\r\n    hideInfoPanel: function () {\r\n        if (this.infoPanel) {\r\n            this.infoPanel.setAttribute('visible', false);\r\n        }\r\n    },\r\n\r\n    getNodeConnections: function (nodeId) {\r\n        if (!window.graphData.links) return [];\r\n\r\n        const connections = [];\r\n\r\n        window.graphData.links.forEach(link => {\r\n            if (link.source === nodeId) {\r\n                const targetNode = window.graphData.nodeMap[link.target];\r\n                if (targetNode) {\r\n                    connections.push({\r\n                        id: link.target,\r\n                        label: targetNode.label,\r\n                        weight: link.weight\r\n                    });\r\n                }\r\n            } else if (link.target === nodeId) {\r\n                const sourceNode = window.graphData.nodeMap[link.source];\r\n                if (sourceNode) {\r\n                    connections.push({\r\n                        id: link.source,\r\n                        label: sourceNode.label,\r\n                        weight: link.weight\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        // Sort by weight descending\r\n        return connections.sort((a, b) => b.weight - a.weight);\r\n    },\r\n\r\n    capitalizeFirst: function (str) {\r\n        if (!str) return '-';\r\n        return str.charAt(0).toUpperCase() + str.slice(1);\r\n    },\r\n\r\n    remove: function () {\r\n        // Cleanup event listeners\r\n        const nodes = document.querySelectorAll('.graph-node');\r\n        nodes.forEach(nodeEl => {\r\n            nodeEl.removeEventListener('mouseenter', this.onNodeMouseEnter);\r\n            nodeEl.removeEventListener('mouseleave', this.onNodeMouseLeave);\r\n            nodeEl.removeEventListener('click', this.onNodeClick);\r\n        });\r\n\r\n        const background = document.querySelector('#background');\r\n        if (background) {\r\n            background.removeEventListener('click', this.onBackgroundClick);\r\n        }\r\n    }\r\n});\r\n\r\nconsole.log('[GraphInteraction] Component registered');\r\n"],"names":["RACE_NAMES","AFRAME","registerComponent","schema","infoPanelId","type","default","graphContainerId","init","selectedNodeId","hoveredNodeId","graphLoader","infoPanel","isHoverLocked","onNodeMouseEnter","bind","onNodeMouseLeave","onNodeClick","onBackgroundClick","onGraphLoaded","el","addEventListener","evt","console","log","graphContainer","document","getElementById","data","components","setupNodeListeners","onBackgroundHover","background","querySelector","sky","resetNodeAppearance","showInfoPanel","hideInfoPanel","nodes","querySelectorAll","forEach","nodeEl","length","target","nodeId","getAttribute","setAttribute","nodeColor","getNodeEntity","isNodeConnected","nodeData","window","graphData","nodeMap","color","links","some","link","source","clearHover","stopPropagation","deselectNode","selectNode","resetHighlight","highlightNode","emit","prevNodeId","node","connections","getNodeConnections","nameEl","raceEl","genderEl","weightEl","connectionsCountEl","topConnectionsEl","label","race","gender","charAt","toUpperCase","slice","weight","toString","connCount","total_connections","topConns","map","c","join","targetNode","push","id","sourceNode","sort","a","b","capitalizeFirst","str","remove","removeEventListener"],"version":3,"file":"A-Frame-Knowledge-Graph-Visualization-fresh.dc5094d7.js.map"}