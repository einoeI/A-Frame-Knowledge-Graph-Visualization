const RACE_COLORS={men:"#7A84DD",elves:"#8ACAE5",hobbit:"#BD9267",dwarf:"#B15B60",ainur:"#3A7575",ents:"#E3845D",orcs:"#020104",animal:"#8ACAE5"},HIGHLIGHT_COLOR="#046de7";window.graphData={nodes:[],links:[],nodeMap:{},metadata:null},AFRAME.registerComponent("graph-loader",{schema:{src:{type:"string",default:"./lotr_positioned.json"},nodeScale:{type:"number",default:.03},minNodeSize:{type:"number",default:.15},maxNodeSize:{type:"number",default:.6},edgeColor:{type:"color",default:"#888888"},edgeOpacity:{type:"number",default:.4},showLabels:{type:"boolean",default:!0},labelScale:{type:"number",default:.8},lowPoly:{type:"boolean",default:!0},segmentsWidth:{type:"number",default:12},segmentsHeight:{type:"number",default:8},enableFrustumCulling:{type:"boolean",default:!0}},init:function(){this.nodes=[],this.edges=[],this.nodeEntities={},this.edgeEntities=[],this.labelEntities={},this.loadGraph()},loadGraph:async function(){try{let t=this.data.src+"?v="+Date.now();console.log("[GraphLoader] Loading graph from:",this.data.src);let e=await fetch(t);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let a=await e.json();window.graphData.nodes=a.nodes,window.graphData.links=a.links,window.graphData.metadata=a.metadata,a.nodes.forEach(t=>{t.color=RACE_COLORS[t.race]||"#7A84DD",window.graphData.nodeMap[t.id]=t}),console.log("[GraphLoader] Loaded:",a.metadata),console.log("[GraphLoader] Nodes:",a.nodes.length),console.log("[GraphLoader] Edges:",a.links.length),this.createNodes(a.nodes),this.createEdges(a.links,a.nodes),this.el.emit("graph-loaded",{nodeCount:a.nodes.length,edgeCount:a.links.length})}catch(t){console.error("[GraphLoader] Error loading graph:",t),this.el.emit("graph-error",{error:t.message})}},createNodes:function(t){let e=this.el,a=t.map(t=>t.weight),i=Math.max(...a),s=Math.min(...a);t.forEach(t=>{let a=(t.weight-s)/(i-s),o=this.data.minNodeSize+a*(this.data.maxNodeSize-this.data.minNodeSize),r=RACE_COLORS[t.race]||"#7A84DD",n=document.createElement("a-sphere");n.setAttribute("position",`${t.x} ${t.y} ${t.z}`),n.setAttribute("radius",o),n.setAttribute("color",r),n.setAttribute("class","raycastable graph-node"),n.setAttribute("data-node-id",t.id),n.setAttribute("data-node-label",t.label),n.setAttribute("data-node-race",t.race),n.setAttribute("data-node-color",r),this.data.lowPoly&&(n.setAttribute("segments-width",this.data.segmentsWidth),n.setAttribute("segments-height",this.data.segmentsHeight)),n.setAttribute("material",{color:r,metalness:.3,roughness:.7,flatShading:this.data.lowPoly}),this.data.enableFrustumCulling&&n.addEventListener("loaded",()=>{n.object3D&&(n.object3D.frustumCulled=!0)}),this.nodeEntities[t.id]=n,e.appendChild(n),this.data.showLabels&&this.createLabel(t,n,o)}),console.log("[GraphLoader] Created",Object.keys(this.nodeEntities).length,"nodes")},createLabel:function(t,e,a){let i=document.createElement("a-text");i.setAttribute("value",t.label),i.setAttribute("position",`0 ${a+.15} 0`),i.setAttribute("align","center"),i.setAttribute("color","white"),i.setAttribute("scale",`${this.data.labelScale} ${this.data.labelScale} ${this.data.labelScale}`),i.setAttribute("look-at","[camera]"),i.setAttribute("class","node-label"),i.setAttribute("data-node-id",t.id),i.setAttribute("shader","msdf"),i.setAttribute("font","https://cdn.aframe.io/fonts/Roboto-msdf.json"),e.appendChild(i),this.labelEntities[t.id]=i},createEdges:function(t,e){let a=this.el,i={};e.forEach(t=>i[t.id]=t);let s=Math.max(...t.map(t=>t.weight));t.forEach((t,e)=>{let o=i[t.source],r=i[t.target];if(!o||!r)return void console.warn("[GraphLoader] Missing node for edge:",t);let n=.2+t.weight/s*.6,l=document.createElement("a-entity");l.setAttribute("line",{start:`${o.x} ${o.y} ${o.z}`,end:`${r.x} ${r.y} ${r.z}`,color:this.data.edgeColor,opacity:n}),l.setAttribute("class","graph-edge"),l.setAttribute("data-source",t.source),l.setAttribute("data-target",t.target),l.setAttribute("data-weight",t.weight),l.setAttribute("data-edge-index",e),this.edgeEntities.push(l),a.appendChild(l)}),console.log("[GraphLoader] Created",this.edgeEntities.length,"edges")},highlightNode:function(t){if(!window.graphData.nodeMap[t])return;let e=new Set([t]);window.graphData.links.forEach(a=>{a.source===t&&e.add(a.target),a.target===t&&e.add(a.source)}),Object.keys(this.nodeEntities).forEach(a=>{let i=this.nodeEntities[a],s=window.graphData.nodeMap[a];a===t?(i.setAttribute("material","color",HIGHLIGHT_COLOR),i.setAttribute("material","emissive",HIGHLIGHT_COLOR),i.setAttribute("material","emissiveIntensity",.3)):e.has(a)?(i.setAttribute("material","color",s.color),i.setAttribute("material","opacity",1)):(i.setAttribute("material","color","#444444"),i.setAttribute("material","opacity",.3))}),this.edgeEntities.forEach(e=>{let a=e.getAttribute("data-source"),i=e.getAttribute("data-target");a===t||i===t?(e.setAttribute("line","color",HIGHLIGHT_COLOR),e.setAttribute("line","opacity",.9)):(e.setAttribute("line","color","#333333"),e.setAttribute("line","opacity",.1))}),Object.keys(this.labelEntities).forEach(t=>{let a=this.labelEntities[t];e.has(t)?(a.setAttribute("visible",!0),a.setAttribute("opacity",1)):a.setAttribute("opacity",.2)})},resetHighlight:function(){Object.keys(this.nodeEntities).forEach(t=>{let e=this.nodeEntities[t],a=window.graphData.nodeMap[t],i=a?a.color:"#7A84DD";e.setAttribute("material","color",i),e.setAttribute("material","opacity",1),e.setAttribute("material","emissive","#000000"),e.setAttribute("material","emissiveIntensity",0)}),this.edgeEntities.forEach(t=>{let e=parseFloat(t.getAttribute("data-weight")),a=window.graphData.metadata?.max_edge_weight||533;t.setAttribute("line","color",this.data.edgeColor),t.setAttribute("line","opacity",.2+e/a*.6)}),Object.keys(this.labelEntities).forEach(t=>{let e=this.labelEntities[t];e.setAttribute("visible",!0),e.setAttribute("opacity",1)})},getNodeEntity:function(t){return this.nodeEntities[t]},getAllNodeEntities:function(){return this.nodeEntities},getAllEdgeEntities:function(){return this.edgeEntities}}),console.log("[GraphLoader] Component registered");
//# sourceMappingURL=A-Frame-Knowledge-Graph-Visualization-fresh.cbba908b.js.map
