{"mappings":"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","sources":["<anon>","src/components/graph-loader.js"],"sourcesContent":["/**\r\n * Graph Loader Component for A-Frame\r\n * Loads LOTR character network from pre-positioned JSON\r\n * Creates 3D nodes, edges, and labels\r\n */ /* global AFRAME, THREE */ // Race colors (same as 2D visualization)\nconst RACE_COLORS = {\n    'men': '#7A84DD',\n    'elves': '#8ACAE5',\n    'hobbit': '#BD9267',\n    'dwarf': '#B15B60',\n    'ainur': '#3A7575',\n    'ents': '#E3845D',\n    'orcs': '#020104',\n    'animal': '#8ACAE5'\n};\n// Highlight color\nconst HIGHLIGHT_COLOR = '#046de7';\n// Store global graph data for other components\nwindow.graphData = {\n    nodes: [],\n    links: [],\n    nodeMap: {},\n    metadata: null\n};\nAFRAME.registerComponent('graph-loader', {\n    schema: {\n        src: {\n            type: 'string',\n            default: './lotr_positioned.json'\n        },\n        nodeScale: {\n            type: 'number',\n            default: 0.03\n        },\n        minNodeSize: {\n            type: 'number',\n            default: 0.15\n        },\n        maxNodeSize: {\n            type: 'number',\n            default: 0.6\n        },\n        edgeColor: {\n            type: 'color',\n            default: '#888888'\n        },\n        edgeOpacity: {\n            type: 'number',\n            default: 0.4\n        },\n        showLabels: {\n            type: 'boolean',\n            default: true\n        },\n        labelScale: {\n            type: 'number',\n            default: 0.8\n        },\n        // Performance options\n        lowPoly: {\n            type: 'boolean',\n            default: true\n        },\n        segmentsWidth: {\n            type: 'number',\n            default: 12\n        },\n        segmentsHeight: {\n            type: 'number',\n            default: 8\n        },\n        enableFrustumCulling: {\n            type: 'boolean',\n            default: true\n        }\n    },\n    init: function() {\n        this.nodes = [];\n        this.edges = [];\n        this.nodeEntities = {};\n        this.edgeEntities = [];\n        this.labelEntities = {};\n        this.loadGraph();\n    },\n    loadGraph: async function() {\n        try {\n            // Add cache-busting parameter to prevent stale data\n            const url = this.data.src + '?v=' + Date.now();\n            console.log('[GraphLoader] Loading graph from:', this.data.src);\n            const response = await fetch(url);\n            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n            const data = await response.json();\n            // Store globally for other components\n            window.graphData.nodes = data.nodes;\n            window.graphData.links = data.links;\n            window.graphData.metadata = data.metadata;\n            // Create node lookup map and store colors\n            data.nodes.forEach((node)=>{\n                node.color = RACE_COLORS[node.race] || '#7A84DD';\n                window.graphData.nodeMap[node.id] = node;\n            });\n            console.log('[GraphLoader] Loaded:', data.metadata);\n            console.log('[GraphLoader] Nodes:', data.nodes.length);\n            console.log('[GraphLoader] Edges:', data.links.length);\n            // Create graph elements\n            this.createNodes(data.nodes);\n            this.createEdges(data.links, data.nodes);\n            // Emit event when graph is loaded\n            this.el.emit('graph-loaded', {\n                nodeCount: data.nodes.length,\n                edgeCount: data.links.length\n            });\n        } catch (error) {\n            console.error('[GraphLoader] Error loading graph:', error);\n            this.el.emit('graph-error', {\n                error: error.message\n            });\n        }\n    },\n    createNodes: function(nodes) {\n        const container = this.el;\n        // Calculate size range\n        const weights = nodes.map((n)=>n.weight);\n        const maxWeight = Math.max(...weights);\n        const minWeight = Math.min(...weights);\n        nodes.forEach((node)=>{\n            // Calculate node size based on weight\n            const normalizedWeight = (node.weight - minWeight) / (maxWeight - minWeight);\n            const nodeSize = this.data.minNodeSize + normalizedWeight * (this.data.maxNodeSize - this.data.minNodeSize);\n            // Get race color\n            const color = RACE_COLORS[node.race] || '#7A84DD';\n            // Create node sphere with performance optimizations\n            const nodeEl = document.createElement('a-sphere');\n            nodeEl.setAttribute('position', `${node.x} ${node.y} ${node.z}`);\n            nodeEl.setAttribute('radius', nodeSize);\n            nodeEl.setAttribute('color', color);\n            nodeEl.setAttribute('class', 'raycastable graph-node');\n            nodeEl.setAttribute('data-node-id', node.id);\n            nodeEl.setAttribute('data-node-label', node.label);\n            nodeEl.setAttribute('data-node-race', node.race);\n            nodeEl.setAttribute('data-node-color', color);\n            // Performance: Use lower polygon count for spheres\n            if (this.data.lowPoly) {\n                nodeEl.setAttribute('segments-width', this.data.segmentsWidth);\n                nodeEl.setAttribute('segments-height', this.data.segmentsHeight);\n            }\n            // Add metallic material for better VR appearance\n            nodeEl.setAttribute('material', {\n                color: color,\n                metalness: 0.3,\n                roughness: 0.7,\n                flatShading: this.data.lowPoly // Flat shading for performance\n            });\n            // Performance: Enable frustum culling\n            if (this.data.enableFrustumCulling) nodeEl.addEventListener('loaded', ()=>{\n                if (nodeEl.object3D) nodeEl.object3D.frustumCulled = true;\n            });\n            // Store reference\n            this.nodeEntities[node.id] = nodeEl;\n            // Add to scene\n            container.appendChild(nodeEl);\n            // Create label if enabled\n            if (this.data.showLabels) this.createLabel(node, nodeEl, nodeSize);\n        });\n        console.log('[GraphLoader] Created', Object.keys(this.nodeEntities).length, 'nodes');\n    },\n    createLabel: function(node, parentEl, nodeSize) {\n        const labelEl = document.createElement('a-text');\n        // Position label above the node\n        labelEl.setAttribute('value', node.label);\n        labelEl.setAttribute('position', `0 ${nodeSize + 0.15} 0`);\n        labelEl.setAttribute('align', 'center');\n        labelEl.setAttribute('color', 'white');\n        labelEl.setAttribute('scale', `${this.data.labelScale} ${this.data.labelScale} ${this.data.labelScale}`);\n        labelEl.setAttribute('look-at', '[camera]'); // Billboard effect\n        labelEl.setAttribute('class', 'node-label');\n        labelEl.setAttribute('data-node-id', node.id);\n        // Add slight background for readability\n        labelEl.setAttribute('shader', 'msdf');\n        labelEl.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');\n        parentEl.appendChild(labelEl);\n        this.labelEntities[node.id] = labelEl;\n    },\n    createEdges: function(links, nodes) {\n        const container = this.el;\n        const nodeMap = {};\n        nodes.forEach((n)=>nodeMap[n.id] = n);\n        // Calculate max weight for opacity scaling\n        const maxWeight = Math.max(...links.map((l)=>l.weight));\n        links.forEach((link, index)=>{\n            const sourceNode = nodeMap[link.source];\n            const targetNode = nodeMap[link.target];\n            if (!sourceNode || !targetNode) {\n                console.warn('[GraphLoader] Missing node for edge:', link);\n                return;\n            }\n            // Calculate opacity based on weight\n            const opacity = 0.2 + link.weight / maxWeight * 0.6;\n            // Create edge using a-entity with line component\n            const edgeEl = document.createElement('a-entity');\n            edgeEl.setAttribute('line', {\n                start: `${sourceNode.x} ${sourceNode.y} ${sourceNode.z}`,\n                end: `${targetNode.x} ${targetNode.y} ${targetNode.z}`,\n                color: this.data.edgeColor,\n                opacity: opacity\n            });\n            edgeEl.setAttribute('class', 'graph-edge');\n            edgeEl.setAttribute('data-source', link.source);\n            edgeEl.setAttribute('data-target', link.target);\n            edgeEl.setAttribute('data-weight', link.weight);\n            edgeEl.setAttribute('data-edge-index', index);\n            this.edgeEntities.push(edgeEl);\n            container.appendChild(edgeEl);\n        });\n        console.log('[GraphLoader] Created', this.edgeEntities.length, 'edges');\n    },\n    // Public method to highlight a node and its connections\n    highlightNode: function(nodeId) {\n        const node = window.graphData.nodeMap[nodeId];\n        if (!node) return;\n        // Get connected node IDs\n        const connectedIds = new Set([\n            nodeId\n        ]);\n        window.graphData.links.forEach((link)=>{\n            if (link.source === nodeId) connectedIds.add(link.target);\n            if (link.target === nodeId) connectedIds.add(link.source);\n        });\n        // Update node appearances\n        Object.keys(this.nodeEntities).forEach((id)=>{\n            const nodeEl = this.nodeEntities[id];\n            const nodeData = window.graphData.nodeMap[id];\n            if (id === nodeId) {\n                // Selected node - highlight color\n                nodeEl.setAttribute('material', 'color', HIGHLIGHT_COLOR);\n                nodeEl.setAttribute('material', 'emissive', HIGHLIGHT_COLOR);\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0.3);\n            } else if (connectedIds.has(id)) {\n                // Connected node - keep original color, full opacity\n                nodeEl.setAttribute('material', 'color', nodeData.color);\n                nodeEl.setAttribute('material', 'opacity', 1);\n            } else {\n                // Unconnected node - dim\n                nodeEl.setAttribute('material', 'color', '#444444');\n                nodeEl.setAttribute('material', 'opacity', 0.3);\n            }\n        });\n        // Update edge appearances\n        this.edgeEntities.forEach((edgeEl)=>{\n            const source = edgeEl.getAttribute('data-source');\n            const target = edgeEl.getAttribute('data-target');\n            if (source === nodeId || target === nodeId) {\n                // Connected edge - highlight\n                edgeEl.setAttribute('line', 'color', HIGHLIGHT_COLOR);\n                edgeEl.setAttribute('line', 'opacity', 0.9);\n            } else {\n                // Unconnected edge - dim\n                edgeEl.setAttribute('line', 'color', '#333333');\n                edgeEl.setAttribute('line', 'opacity', 0.1);\n            }\n        });\n        // Update label visibility\n        Object.keys(this.labelEntities).forEach((id)=>{\n            const labelEl = this.labelEntities[id];\n            if (connectedIds.has(id)) {\n                labelEl.setAttribute('visible', true);\n                labelEl.setAttribute('opacity', 1);\n            } else labelEl.setAttribute('opacity', 0.2);\n        });\n    },\n    // Public method to reset highlights\n    resetHighlight: function() {\n        // Reset nodes\n        Object.keys(this.nodeEntities).forEach((id)=>{\n            const nodeEl = this.nodeEntities[id];\n            const nodeData = window.graphData.nodeMap[id];\n            const color = nodeData ? nodeData.color : '#7A84DD';\n            nodeEl.setAttribute('material', 'color', color);\n            nodeEl.setAttribute('material', 'opacity', 1);\n            nodeEl.setAttribute('material', 'emissive', '#000000');\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0);\n        });\n        // Reset edges\n        this.edgeEntities.forEach((edgeEl)=>{\n            const weight = parseFloat(edgeEl.getAttribute('data-weight'));\n            const maxWeight = window.graphData.metadata?.max_edge_weight || 533;\n            const opacity = 0.2 + weight / maxWeight * 0.6;\n            edgeEl.setAttribute('line', 'color', this.data.edgeColor);\n            edgeEl.setAttribute('line', 'opacity', opacity);\n        });\n        // Reset labels\n        Object.keys(this.labelEntities).forEach((id)=>{\n            const labelEl = this.labelEntities[id];\n            labelEl.setAttribute('visible', true);\n            labelEl.setAttribute('opacity', 1);\n        });\n    },\n    // Get node entity by ID\n    getNodeEntity: function(nodeId) {\n        return this.nodeEntities[nodeId];\n    },\n    // Get all node entities\n    getAllNodeEntities: function() {\n        return this.nodeEntities;\n    },\n    // Get all edge entities\n    getAllEdgeEntities: function() {\n        return this.edgeEntities;\n    }\n});\nconsole.log('[GraphLoader] Component registered');\n\n//# sourceMappingURL=A-Frame-Knowledge-Graph-Visualization-fresh.cbba908b.js.map\n","/**\r\n * Graph Loader Component for A-Frame\r\n * Loads LOTR character network from pre-positioned JSON\r\n * Creates 3D nodes, edges, and labels\r\n */\r\n\r\n/* global AFRAME, THREE */\r\n\r\n// Race colors (same as 2D visualization)\r\nconst RACE_COLORS = {\r\n    'men': '#7A84DD',\r\n    'elves': '#8ACAE5',\r\n    'hobbit': '#BD9267',\r\n    'dwarf': '#B15B60',\r\n    'ainur': '#3A7575',\r\n    'ents': '#E3845D',\r\n    'orcs': '#020104',\r\n    'animal': '#8ACAE5'\r\n};\r\n\r\n// Highlight color\r\nconst HIGHLIGHT_COLOR = '#046de7';\r\n\r\n// Store global graph data for other components\r\nwindow.graphData = {\r\n    nodes: [],\r\n    links: [],\r\n    nodeMap: {},\r\n    metadata: null\r\n};\r\n\r\nAFRAME.registerComponent('graph-loader', {\r\n    schema: {\r\n        src: { type: 'string', default: './lotr_positioned.json' },\r\n        nodeScale: { type: 'number', default: 0.03 },  // Scale factor for node sizes\r\n        minNodeSize: { type: 'number', default: 0.15 },\r\n        maxNodeSize: { type: 'number', default: 0.6 },\r\n        edgeColor: { type: 'color', default: '#888888' },\r\n        edgeOpacity: { type: 'number', default: 0.4 },\r\n        showLabels: { type: 'boolean', default: true },\r\n        labelScale: { type: 'number', default: 0.8 },\r\n        // Performance options\r\n        lowPoly: { type: 'boolean', default: true },       // Use low-poly spheres\r\n        segmentsWidth: { type: 'number', default: 12 },    // Sphere horizontal segments\r\n        segmentsHeight: { type: 'number', default: 8 },    // Sphere vertical segments\r\n        enableFrustumCulling: { type: 'boolean', default: true }\r\n    },\r\n\r\n    init: function () {\r\n        this.nodes = [];\r\n        this.edges = [];\r\n        this.nodeEntities = {};\r\n        this.edgeEntities = [];\r\n        this.labelEntities = {};\r\n\r\n        this.loadGraph();\r\n    },\r\n\r\n    loadGraph: async function () {\r\n        try {\r\n            // Add cache-busting parameter to prevent stale data\r\n            const url = this.data.src + '?v=' + Date.now();\r\n            console.log('[GraphLoader] Loading graph from:', this.data.src);\r\n\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error! status: ${response.status}`);\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            // Store globally for other components\r\n            window.graphData.nodes = data.nodes;\r\n            window.graphData.links = data.links;\r\n            window.graphData.metadata = data.metadata;\r\n\r\n            // Create node lookup map and store colors\r\n            data.nodes.forEach(node => {\r\n                node.color = RACE_COLORS[node.race] || '#7A84DD';\r\n                window.graphData.nodeMap[node.id] = node;\r\n            });\r\n\r\n            console.log('[GraphLoader] Loaded:', data.metadata);\r\n            console.log('[GraphLoader] Nodes:', data.nodes.length);\r\n            console.log('[GraphLoader] Edges:', data.links.length);\r\n\r\n            // Create graph elements\r\n            this.createNodes(data.nodes);\r\n            this.createEdges(data.links, data.nodes);\r\n\r\n            // Emit event when graph is loaded\r\n            this.el.emit('graph-loaded', {\r\n                nodeCount: data.nodes.length,\r\n                edgeCount: data.links.length\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('[GraphLoader] Error loading graph:', error);\r\n            this.el.emit('graph-error', { error: error.message });\r\n        }\r\n    },\r\n\r\n    createNodes: function (nodes) {\r\n        const container = this.el;\r\n\r\n        // Calculate size range\r\n        const weights = nodes.map(n => n.weight);\r\n        const maxWeight = Math.max(...weights);\r\n        const minWeight = Math.min(...weights);\r\n\r\n        nodes.forEach(node => {\r\n            // Calculate node size based on weight\r\n            const normalizedWeight = (node.weight - minWeight) / (maxWeight - minWeight);\r\n            const nodeSize = this.data.minNodeSize +\r\n                normalizedWeight * (this.data.maxNodeSize - this.data.minNodeSize);\r\n\r\n            // Get race color\r\n            const color = RACE_COLORS[node.race] || '#7A84DD';\r\n\r\n            // Create node sphere with performance optimizations\r\n            const nodeEl = document.createElement('a-sphere');\r\n            nodeEl.setAttribute('position', `${node.x} ${node.y} ${node.z}`);\r\n            nodeEl.setAttribute('radius', nodeSize);\r\n            nodeEl.setAttribute('color', color);\r\n            nodeEl.setAttribute('class', 'raycastable graph-node');\r\n            nodeEl.setAttribute('data-node-id', node.id);\r\n            nodeEl.setAttribute('data-node-label', node.label);\r\n            nodeEl.setAttribute('data-node-race', node.race);\r\n            nodeEl.setAttribute('data-node-color', color);\r\n\r\n            // Performance: Use lower polygon count for spheres\r\n            if (this.data.lowPoly) {\r\n                nodeEl.setAttribute('segments-width', this.data.segmentsWidth);\r\n                nodeEl.setAttribute('segments-height', this.data.segmentsHeight);\r\n            }\r\n\r\n            // Add metallic material for better VR appearance\r\n            nodeEl.setAttribute('material', {\r\n                color: color,\r\n                metalness: 0.3,\r\n                roughness: 0.7,\r\n                flatShading: this.data.lowPoly  // Flat shading for performance\r\n            });\r\n\r\n            // Performance: Enable frustum culling\r\n            if (this.data.enableFrustumCulling) {\r\n                nodeEl.addEventListener('loaded', () => {\r\n                    if (nodeEl.object3D) {\r\n                        nodeEl.object3D.frustumCulled = true;\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Store reference\r\n            this.nodeEntities[node.id] = nodeEl;\r\n\r\n            // Add to scene\r\n            container.appendChild(nodeEl);\r\n\r\n            // Create label if enabled\r\n            if (this.data.showLabels) {\r\n                this.createLabel(node, nodeEl, nodeSize);\r\n            }\r\n        });\r\n\r\n        console.log('[GraphLoader] Created', Object.keys(this.nodeEntities).length, 'nodes');\r\n    },\r\n\r\n    createLabel: function (node, parentEl, nodeSize) {\r\n        const labelEl = document.createElement('a-text');\r\n\r\n        // Position label above the node\r\n        labelEl.setAttribute('value', node.label);\r\n        labelEl.setAttribute('position', `0 ${nodeSize + 0.15} 0`);\r\n        labelEl.setAttribute('align', 'center');\r\n        labelEl.setAttribute('color', 'white');\r\n        labelEl.setAttribute('scale', `${this.data.labelScale} ${this.data.labelScale} ${this.data.labelScale}`);\r\n        labelEl.setAttribute('look-at', '[camera]');  // Billboard effect\r\n        labelEl.setAttribute('class', 'node-label');\r\n        labelEl.setAttribute('data-node-id', node.id);\r\n\r\n        // Add slight background for readability\r\n        labelEl.setAttribute('shader', 'msdf');\r\n        labelEl.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');\r\n\r\n        parentEl.appendChild(labelEl);\r\n        this.labelEntities[node.id] = labelEl;\r\n    },\r\n\r\n    createEdges: function (links, nodes) {\r\n        const container = this.el;\r\n        const nodeMap = {};\r\n        nodes.forEach(n => nodeMap[n.id] = n);\r\n\r\n        // Calculate max weight for opacity scaling\r\n        const maxWeight = Math.max(...links.map(l => l.weight));\r\n\r\n        links.forEach((link, index) => {\r\n            const sourceNode = nodeMap[link.source];\r\n            const targetNode = nodeMap[link.target];\r\n\r\n            if (!sourceNode || !targetNode) {\r\n                console.warn('[GraphLoader] Missing node for edge:', link);\r\n                return;\r\n            }\r\n\r\n            // Calculate opacity based on weight\r\n            const opacity = 0.2 + (link.weight / maxWeight) * 0.6;\r\n\r\n            // Create edge using a-entity with line component\r\n            const edgeEl = document.createElement('a-entity');\r\n            edgeEl.setAttribute('line', {\r\n                start: `${sourceNode.x} ${sourceNode.y} ${sourceNode.z}`,\r\n                end: `${targetNode.x} ${targetNode.y} ${targetNode.z}`,\r\n                color: this.data.edgeColor,\r\n                opacity: opacity\r\n            });\r\n            edgeEl.setAttribute('class', 'graph-edge');\r\n            edgeEl.setAttribute('data-source', link.source);\r\n            edgeEl.setAttribute('data-target', link.target);\r\n            edgeEl.setAttribute('data-weight', link.weight);\r\n            edgeEl.setAttribute('data-edge-index', index);\r\n\r\n            this.edgeEntities.push(edgeEl);\r\n            container.appendChild(edgeEl);\r\n        });\r\n\r\n        console.log('[GraphLoader] Created', this.edgeEntities.length, 'edges');\r\n    },\r\n\r\n    // Public method to highlight a node and its connections\r\n    highlightNode: function (nodeId) {\r\n        const node = window.graphData.nodeMap[nodeId];\r\n        if (!node) return;\r\n\r\n        // Get connected node IDs\r\n        const connectedIds = new Set([nodeId]);\r\n        window.graphData.links.forEach(link => {\r\n            if (link.source === nodeId) connectedIds.add(link.target);\r\n            if (link.target === nodeId) connectedIds.add(link.source);\r\n        });\r\n\r\n        // Update node appearances\r\n        Object.keys(this.nodeEntities).forEach(id => {\r\n            const nodeEl = this.nodeEntities[id];\r\n            const nodeData = window.graphData.nodeMap[id];\r\n\r\n            if (id === nodeId) {\r\n                // Selected node - highlight color\r\n                nodeEl.setAttribute('material', 'color', HIGHLIGHT_COLOR);\r\n                nodeEl.setAttribute('material', 'emissive', HIGHLIGHT_COLOR);\r\n                nodeEl.setAttribute('material', 'emissiveIntensity', 0.3);\r\n            } else if (connectedIds.has(id)) {\r\n                // Connected node - keep original color, full opacity\r\n                nodeEl.setAttribute('material', 'color', nodeData.color);\r\n                nodeEl.setAttribute('material', 'opacity', 1);\r\n            } else {\r\n                // Unconnected node - dim\r\n                nodeEl.setAttribute('material', 'color', '#444444');\r\n                nodeEl.setAttribute('material', 'opacity', 0.3);\r\n            }\r\n        });\r\n\r\n        // Update edge appearances\r\n        this.edgeEntities.forEach(edgeEl => {\r\n            const source = edgeEl.getAttribute('data-source');\r\n            const target = edgeEl.getAttribute('data-target');\r\n\r\n            if (source === nodeId || target === nodeId) {\r\n                // Connected edge - highlight\r\n                edgeEl.setAttribute('line', 'color', HIGHLIGHT_COLOR);\r\n                edgeEl.setAttribute('line', 'opacity', 0.9);\r\n            } else {\r\n                // Unconnected edge - dim\r\n                edgeEl.setAttribute('line', 'color', '#333333');\r\n                edgeEl.setAttribute('line', 'opacity', 0.1);\r\n            }\r\n        });\r\n\r\n        // Update label visibility\r\n        Object.keys(this.labelEntities).forEach(id => {\r\n            const labelEl = this.labelEntities[id];\r\n            if (connectedIds.has(id)) {\r\n                labelEl.setAttribute('visible', true);\r\n                labelEl.setAttribute('opacity', 1);\r\n            } else {\r\n                labelEl.setAttribute('opacity', 0.2);\r\n            }\r\n        });\r\n    },\r\n\r\n    // Public method to reset highlights\r\n    resetHighlight: function () {\r\n        // Reset nodes\r\n        Object.keys(this.nodeEntities).forEach(id => {\r\n            const nodeEl = this.nodeEntities[id];\r\n            const nodeData = window.graphData.nodeMap[id];\r\n            const color = nodeData ? nodeData.color : '#7A84DD';\r\n\r\n            nodeEl.setAttribute('material', 'color', color);\r\n            nodeEl.setAttribute('material', 'opacity', 1);\r\n            nodeEl.setAttribute('material', 'emissive', '#000000');\r\n            nodeEl.setAttribute('material', 'emissiveIntensity', 0);\r\n        });\r\n\r\n        // Reset edges\r\n        this.edgeEntities.forEach(edgeEl => {\r\n            const weight = parseFloat(edgeEl.getAttribute('data-weight'));\r\n            const maxWeight = window.graphData.metadata?.max_edge_weight || 533;\r\n            const opacity = 0.2 + (weight / maxWeight) * 0.6;\r\n\r\n            edgeEl.setAttribute('line', 'color', this.data.edgeColor);\r\n            edgeEl.setAttribute('line', 'opacity', opacity);\r\n        });\r\n\r\n        // Reset labels\r\n        Object.keys(this.labelEntities).forEach(id => {\r\n            const labelEl = this.labelEntities[id];\r\n            labelEl.setAttribute('visible', true);\r\n            labelEl.setAttribute('opacity', 1);\r\n        });\r\n    },\r\n\r\n    // Get node entity by ID\r\n    getNodeEntity: function (nodeId) {\r\n        return this.nodeEntities[nodeId];\r\n    },\r\n\r\n    // Get all node entities\r\n    getAllNodeEntities: function () {\r\n        return this.nodeEntities;\r\n    },\r\n\r\n    // Get all edge entities\r\n    getAllEdgeEntities: function () {\r\n        return this.edgeEntities;\r\n    }\r\n});\r\n\r\nconsole.log('[GraphLoader] Component registered');\r\n"],"names":["RACE_COLORS","HIGHLIGHT_COLOR","window","graphData","nodes","links","nodeMap","metadata","AFRAME","registerComponent","schema","src","type","default","nodeScale","minNodeSize","maxNodeSize","edgeColor","edgeOpacity","showLabels","labelScale","lowPoly","segmentsWidth","segmentsHeight","enableFrustumCulling","init","edges","nodeEntities","edgeEntities","labelEntities","loadGraph","url","data","Date","now","console","log","response","fetch","ok","Error","status","json","forEach","node","color","race","id","length","createNodes","createEdges","el","emit","nodeCount","edgeCount","error","message","container","weights","map","n","weight","maxWeight","Math","max","minWeight","min","normalizedWeight","nodeSize","nodeEl","document","createElement","setAttribute","x","y","z","label","metalness","roughness","flatShading","addEventListener","object3D","frustumCulled","appendChild","createLabel","Object","keys","parentEl","labelEl","l","link","index","sourceNode","source","targetNode","target","warn","opacity","edgeEl","start","end","push","highlightNode","nodeId","connectedIds","Set","add","nodeData","has","getAttribute","resetHighlight","parseFloat","max_edge_weight","getNodeEntity","getAllNodeEntities","getAllEdgeEntities"],"version":3,"file":"A-Frame-Knowledge-Graph-Visualization-fresh.cbba908b.js.map"}